##################################################
#
# Protocol file for Lauda devices
# Proline RP 855
# Proline RP 890
# ecoline silver RE415
# ecoline gold RE1050W 
# integral T4600 (beamline I22)
#
##################################################


##################################################
# General Settings
##################################################

Terminator = "\r\n";
ReplyTimeout = 1000;


###################################################
# Get functions
###################################################

# /// Read water bath temperature
# /// using the IN_PV_00 command
getTemp {
   ExtraInput = Ignore;
   out "IN_PV_00";
   in "%f";
}

# /// Read external pt100 temperature using the in_pv_03 command, 
# /// valid for ecoline and proline
getExtTemp {
   ExtraInput = Ignore;
   out "IN_PV_03";
   in "%f";
   # Parse error status
   @mismatch{in "%(\$1:ERROR)s";}
}

# /// Read external pt100 temperature using the in_pv_01 command,
# /// valid for integral T model
getExtTemp1 {
   ExtraInput = Ignore;
   out "IN_PV_01";
   in "%f";
   # Parse error status
   @mismatch{in "%(\$1:ERROR)s";}
}

# /// Read error diagnosis response, using the "stat" command
getStatus {
   ExtraInput = Ignore;
   Separator = "";
   out "STAT";
   in "%5d";
}

# /// Read water bath level on the proline lauda baths, using the "in_pv_05" command, valid in proline only
getLevel {
   ExtraInput = Ignore;
   out "IN_PV_05";
   in "%d";
   # Parse error status
   @mismatch{in "%(\$1:ERROR)s";}
}

# /// Read pump level (1 to 8)
getPump {
   ExtraInput = Ignore;
   out "IN_SP_01";
   in "%d";
}

# /// Read temperature setpoint 
getTempReadback {
    ExtraInput = Ignore;
    out "IN_SP_00";
    in "%f";
}

###################################################
# Set functions
###################################################

# /// Set the setpoint for water temperature (temperature must be specific format (up to 3 digits before decimal point and up to 2 digits after decimal point).
setTemp {
   out "OUT_SP_00_%.2f";
}

# /// Set the pump level (0 to 8)
setPump {
   out "OUT_SP_01_%d";
}

#############################################################
# Generic protocol
############################################################

# /// Use this send any command and get back the response (max 39 chars).
gen {
    ExtraInput = Ignore;
    out "%s";
    in "%39c"
}

selectProg {
    out "RMP_SELECT_%d";
    in "%39c";
}

clearProg {
    out "RMP_RESET";
    in "%39c";
}

setRepeat {
    out "RMP_OUT_02_%03d";
    in "%39c";
}

getSegment {
    out "RMP_IN_01";
    in "%d";
}
getTotalRuns {
    out "RMP_IN_02";
    in "%d";
}
getRunNumber {
    out "RMP_IN_03";
    in "%d";
}
getSelectedProg {
    out "RMP_IN_04";
    in "%d";
}
getProgRunning {
    out "RMP_IN_05";
    in "%d";
}

setStep {
    out "RMP_OUT_00_%(\$1:TEMP).2f_%(\$1:TIME)03d";
    in "OK";
    @mismatch{in "%(\$1:SERROR)s";}
}
